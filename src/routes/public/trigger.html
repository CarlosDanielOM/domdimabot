<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Triggers</title>
</head>

<body>
    <div class="triggerContainer" id="triggerContainer"></div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"></script>
    <script>
        let channel = window.location.pathname.split('/')[3];
        const triggerContainer = document.getElementById('triggerContainer');

        triggerContainer.style.display = 'flex';
        triggerContainer.style.justifyContent = 'center';
        triggerContainer.style.alignItems = 'center';
        triggerContainer.style.height = '500px';
        triggerContainer.style.width = '800px';
        triggerContainer.style.border = '1px solid black';

        let triggerCount = 0;

        const socket = io.connect('https://domdimabot.com/', {
            reconnection: true,
            transports: ['websocket']
        });

        const triggerSocket = io(`/overlay/triggers/${channel}`, {
            forceNew: true,
            transports: ['websocket']
        });

        triggerSocket.on('trigger', (data) => {
            triggerCount++;
            const { mediaType, url } = data;
            let triggerType = mediaType.split('/')[0];
            if (triggerType === 'image') {
                triggerContainer.innerHTML = `<img src="${url}" alt="trigger" />`;
            } else if (triggerType === 'video') {
                let videoPlayer = createVideoPlayer(url);
                triggerContainer.appendChild(videoPlayer);
            }
        });

        triggerSocket.on('prepareTriggers', (data) => {
            console.log('Preparing triggers');
        });

        socket.on('connected', () => {
            console.log('Connection Established');
        });

        function createVideoPlayer(url) {
            let randomX = Math.floor(Math.random() * 800) - 250;
            let randomY = Math.floor(Math.random() * 500) - 250;
            let videoPlayer = document.createElement('video');
            videoPlayer.style.position = 'absolute';
            videoPlayer.style.top = `${randomY}px`;
            videoPlayer.style.left = `${randomX}px`;
            videoPlayer.setAttribute('width', '250px');
            videoPlayer.setAttribute('autoplay', 'true');
            videoPlayer.setAttribute('id', triggerCount);
            videoPlayer.innerHTML = `<source src="${url}" type="video/mp4" />`;

            videoPlayer.addEventListener('ended', () => {
                videoPlayer.remove();
            });

            return videoPlayer;
        }
    </script>
</body>

</html>